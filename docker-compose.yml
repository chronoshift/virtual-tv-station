services:
  tv-station:
    build: .
    image: virtual-tv-station:latest
    ports:
      - "8093:8093" # HLS + Dashboard
      - "3333:3333" # LLHLS
    volumes:
      # Map the video file from host to container
      - /home/eric/local-ai-stack/data/copyparty/share/Avengers_Endgame_2019_fixed.mp4:/video.mp4
      
      # Optional: Persist the genesis time so stream sync survives restarts
      - ./genesis.json:/app/genesis.json
    
    # Mount a RAM disk for the stream segments to avoid disk I/O
    tmpfs:
      - /app/stream
      
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=all
      - VIDEO_PATH=/video.mp4
      - PORT=8093
      - LLHLS_PORT=3333
    restart: unless-stopped
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
